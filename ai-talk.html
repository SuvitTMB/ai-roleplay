<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบซ้อมบทสนทนา AI (TTB)</title>
    <!-- โหลด Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- โหลดไอคอน (Heroicons) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/heroicons/2.1.1/24/solid/heroicons.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* ใช้ฟอนต์ Sarabun */
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f4f7fa; /* สีพื้นหลังเทาอ่อน */
        }
        /* TTB Colors (โดยประมาณ) */
        .ttb-blue {
            background-color: #002d63; /* TTB Deep Blue */
        }
        .ttb-orange {
            background-color: #f58220; /* TTB Orange */
        }
        .ttb-orange-hover:hover {
            background-color: #e67313;
        }
        .ttb-blue-text {
            color: #002d63;
        }
        /* Custom scrollbar */
        #transcript-box::-webkit-scrollbar {
            width: 8px;
        }
        #transcript-box::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 4px;
        }
        #transcript-box::-webkit-scrollbar-track {
            background-color: #f1f5f9;
        }
        /* Animation สำหรับสถานะ */
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse-dot {
            animation: pulse-dot 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        /* [NEW] สไตล์สำหรับปุ่มบันทึกเสียง */
/* ... existing code ... -->
            animation: pulse-dot 1.5s infinite;
        }
        
        /* [NEW] สไตล์สำหรับสถานะ Error */
        .status-error {
            color: #ef4444; /* red-500 */
            font-weight: 700;
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <!-- Header -->
    <header class="ttb-blue shadow-md text-white p-4 flex justify-between items-center">
        <h1 class="text-xl md:text-2xl font-bold">ระบบซ้อมบทสนทนา AI (TTB)</h1>
        <div class="flex items-center space-x-2">
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
            <span class="text-sm font-medium">พนักงาน: 12345</span>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto p-4 md:p-6 max-w-7xl">
        
        <!-- ส่วนควบคุมและหน้าจอหลัก -->
        <div class="flex flex-col md:flex-row gap-6">

            <!-- ส่วนการสนทนา (ซ้าย) -->
            <div class="w-full md:w-2/3">
                <div class="bg-white p-5 rounded-xl shadow-lg border border-gray-200">
                    
                    <!-- ส่วนตั้งค่า -->
                    <div class="mb-4 pb-4 border-b border-gray-200 space-y-4">
                        <div>
                            <label for="voice-select" class="block text-sm font-medium text-gray-700 mb-2">เลือกเสียง AI ที่จะสนทนาด้วย:</label>
                            <select id="voice-select" class="w-full md:w-1/2 p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500">
                                <option value="female">เสียงผู้หญิง (คุณฟ้า)</option>
                                <option value="male">เสียงผู้ชาย (คุณที)</option>
                            </select>
                        </div>
                        
                        <!-- [NEW] ช่องใส่ API Key -->
                        <div>
                            <label for="api-key-input" class="block text-sm font-medium text-gray-700 mb-2">
                                Google AI API Key 
                                <span class="text-xs text-gray-500">(สำหรับใช้งานภายนอก)</span>
                            </label>
                            <div class="flex gap-2">
                                <input type="password" id="api-key-input" class="w-full md:w-2/3 p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="วาง API Key ของคุณที่นี่">
                                <button id="save-key-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg shadow-sm transition duration-200">
                                    บันทึก
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- ส่วนควบคุมการสนทนา -->
                    <div class="flex flex-col items-center gap-4 mb-4">
                        <div id="status-indicator" class="flex items-center space-x-2 text-gray-500">
                            <!-- สถานะจะถูกอัปเดตโดย JS -->
                            <svg id="status-icon-ready" class="h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 000 2h6a1 1 0 100-2H7z" clip-rule="evenodd" /></svg>
                            <svg id="status-icon-listening" class="h-5 w-5 text-red-500 pulse-dot hidden" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9 9a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z" clip-rule="evenodd" /></svg>
                            <span id="status-text" class="text-lg font-medium">พร้อมเริ่มการสนทนา</span>
                        </div>
                        
                        <div class="flex space-x-4">
                            <button id="start-btn" class="flex items-center justify-center gap-2 ttb-orange ttb-orange-hover text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:-translate-y-1">
                                <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 20 20"><path d="M7 4a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1H8a1 1 0 01-1-1V4zM5.293 9.293a1 1 0 011.414 0L10 12.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                                เริ่มการสนทนา
                            </button>
                            <button id="stop-btn" class="flex items-center justify-center gap-2 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd" /></svg>
                                สิ้นสุดการสนทนา
                            </button>
                        </div>
                    </div>

                    <!-- กล่องแสดงบทสนทนา -->
                    <div id="transcript-box" class="h-80 w-full bg-gray-50 border border-gray-200 rounded-lg p-4 overflow-y-auto space-y-4">
                        <div class="text-center text-gray-400 italic mt-16">
                            บทสนทนาจะปรากฏที่นี่...
                        </div>
                    </div>

                    <!-- [NEW] ช่องป้อนข้อมูลของพนักงาน -->
                    <div id="input-area" class="mt-4 flex gap-2">
                        <input type="text" id="user-input" class="flex-grow p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="พิมพ์ข้อความของคุณ หรือ กดปุ่มไมค์..." disabled>
                        
                        <button id="record-btn" class="flex-shrink-0 bg-blue-500 hover:bg-blue-600 text-white p-3 rounded-lg shadow-sm transition duration-200 disabled:opacity-50" disabled>
                            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93V17.5a.5.5 0 01-1 0v-2.57A6.98 6.98 0 014.02 12H3a1 1 0 01-1-1V9a1 1 0 011-1h1.02A6.98 6.98 0 0111 4.07V1.5a.5.5 0 011 0v2.57A6.98 6.98 0 0115.98 8H17a1 1 0 011 1v2a1 1 0 01-1 1h-1.02a6.98 6.98 0 01-2.96 2.93z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        
                        <button id="send-btn" class="flex-shrink-0 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg shadow-sm transition duration-200 disabled:opacity-50" disabled>
                            ส่ง
                        </button>
                    </div>

                </div>
            </div>

            <!-- ส่วนผลการประเมิน (ขวา) -->
            <div class="w-full md:w-1/3">
                <div class="bg-white p-5 rounded-xl shadow-lg border border-gray-200 sticky top-6">
                    <h2 class="text-xl font-bold ttb-blue-text mb-4 border-b pb-2">ผลการประเมิน (100 คะแนน)</h2>
                    
                    <div id="evaluation-box">
                        <!-- ส่วนแสดงผลการประเมิน -->
                        <div class="text-center text-gray-500 py-10">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V7c0-1.1.9-2 2-2h11l4 4v11c0 1.1-.9 2-2 2z" /></svg>
                            <p class="mt-2 text-sm font-medium">ผลการประเมินจะแสดงที่นี่<br>หลังจากสิ้นสุดการสนทนา</p>
                        </div>
                    </div>

                    <!-- Spinner ขณะโหลด -->
                    <div id="loading-spinner" class="text-center text-gray-500 py-10 hidden">
                        <svg class="animate-spin mx-auto h-10 w-10 ttb-blue-text" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="mt-3 text-sm font-medium">กำลังประมวลผลการประเมิน...</p>
                    </div>

                </div>
            </div>
        </div>

        <!-- ส่วนประวัติการสนทนา (ด้านล่าง) -->
        <div class="mt-6 bg-white p-5 rounded-xl shadow-lg border border-gray-200">
             <h2 class="text-xl font-bold ttb-blue-text mb-4">ประวัติการสนทนา</h2>
             <div id="history-box" class="space-y-3">
                <p class="text-gray-500 italic">ยังไม่มีประวัติการสนทนาในรอบนี้</p>
             </div>
        </div>
    </div>

    <script>
        // DOM Elements
const _0x212034=_0xbeee;(function(_0x4151af,_0x4488d2){const _0x5f2c3f=_0xbeee,_0x35556c=_0x4151af();while(!![]){try{const _0x2ceb6e=parseInt(_0x5f2c3f(0x211))/0x1+-parseInt(_0x5f2c3f(0x240))/0x2+-parseInt(_0x5f2c3f(0x1c6))/0x3*(parseInt(_0x5f2c3f(0x203))/0x4)+-parseInt(_0x5f2c3f(0x1d8))/0x5*(parseInt(_0x5f2c3f(0x1d5))/0x6)+-parseInt(_0x5f2c3f(0x277))/0x7*(-parseInt(_0x5f2c3f(0x227))/0x8)+parseInt(_0x5f2c3f(0x24c))/0x9+parseInt(_0x5f2c3f(0x1c4))/0xa*(parseInt(_0x5f2c3f(0x272))/0xb);if(_0x2ceb6e===_0x4488d2)break;else _0x35556c['push'](_0x35556c['shift']());}catch(_0x5c850d){_0x35556c['push'](_0x35556c['shift']());}}}(_0xd2c3,0x84704));const startBtn=document['getElementById'](_0x212034(0x23d)),stopBtn=document['getElementById'](_0x212034(0x1c1)),voiceSelect=document['getElementById'](_0x212034(0x248)),transcriptBox=document[_0x212034(0x238)](_0x212034(0x229)),evaluationBox=document[_0x212034(0x238)](_0x212034(0x1ea)),historyBox=document[_0x212034(0x238)]('history-box'),statusText=document[_0x212034(0x238)]('status-text'),statusIconReady=document[_0x212034(0x238)](_0x212034(0x1e0)),statusIconListening=document[_0x212034(0x238)]('status-icon-listening'),loadingSpinner=document[_0x212034(0x238)](_0x212034(0x1bb)),apiKeyInput=document['getElementById'](_0x212034(0x270)),saveKeyBtn=document[_0x212034(0x238)](_0x212034(0x281)),inputArea=document[_0x212034(0x238)](_0x212034(0x20a)),userInput=document[_0x212034(0x238)](_0x212034(0x1ed)),sendBtn=document['getElementById'](_0x212034(0x224)),recordBtn=document[_0x212034(0x238)](_0x212034(0x219));let currentAudio=null,conversationFlag=![],conversationHistory=[],historyCount=0x0;const SpeechRecognition=window[_0x212034(0x274)]||window[_0x212034(0x213)];function _0xbeee(_0x163edf,_0x1c6d46){const _0xd2c38d=_0xd2c3();return _0xbeee=function(_0xbeee6b,_0x1112c0){_0xbeee6b=_0xbeee6b-0x1ba;let _0xcd003c=_0xd2c38d[_0xbeee6b];return _0xcd003c;},_0xbeee(_0x163edf,_0x1c6d46);}let recognition=null;SpeechRecognition?(recognition=new SpeechRecognition(),recognition[_0x212034(0x258)]=_0x212034(0x204),recognition[_0x212034(0x261)]=![],recognition['maxAlternatives']=0x1,recognition['onstart']=()=>{const _0x4316c7=_0x212034;recordBtn['classList'][_0x4316c7(0x1d9)](_0x4316c7(0x1ba)),updateStatus('listening',_0x4316c7(0x27d));},recognition[_0x212034(0x251)]=_0x3385ff=>{const _0x152cf2=_0x212034,_0x32c0a3=_0x3385ff[_0x152cf2(0x207)][0x0][0x0]['transcript'];userInput[_0x152cf2(0x1f1)]=_0x32c0a3,handleUserMessage();},recognition[_0x212034(0x26a)]=()=>{const _0x11973f=_0x212034;recognition[_0x11973f(0x280)]();},recognition[_0x212034(0x230)]=()=>{const _0x107d42=_0x212034;recordBtn[_0x107d42(0x1d7)][_0x107d42(0x25a)]('recording-btn'),conversationFlag&&updateStatus(_0x107d42(0x1be),_0x107d42(0x1bf));},recognition[_0x212034(0x1ff)]=_0x5e7891=>{const _0x4859b9=_0x212034;console[_0x4859b9(0x23e)](_0x4859b9(0x1ec),_0x5e7891['error']),recordBtn[_0x4859b9(0x1d7)]['remove'](_0x4859b9(0x1ba)),updateStatus(_0x4859b9(0x1db),'เกิดข้อผิดพลาดในการบันทึกเสียง',!![]);}):(console[_0x212034(0x1e4)](_0x212034(0x247)),recordBtn[_0x212034(0x26b)]=!![],recordBtn['title']=_0x212034(0x1c9));function base64ToArrayBuffer(_0x1dccb){const _0x444156=_0x212034,_0x53f13b=window['atob'](_0x1dccb),_0x407b57=_0x53f13b[_0x444156(0x242)],_0x3d6484=new Uint8Array(_0x407b57);for(let _0x2dda62=0x0;_0x2dda62<_0x407b57;_0x2dda62++){_0x3d6484[_0x2dda62]=_0x53f13b[_0x444156(0x252)](_0x2dda62);}return _0x3d6484[_0x444156(0x1e3)];}function pcmToWav(_0xafed19,_0x8a6ea9){const _0xbde887=_0x212034,_0xb9c407=new Int16Array(_0xafed19),_0x354368=0x1,_0x4deb5e=0x10,_0x1fd1cc=_0x8a6ea9*_0x354368*(_0x4deb5e/0x8),_0x13ef55=_0x354368*(_0x4deb5e/0x8),_0x269c9b=_0xb9c407[_0xbde887(0x242)]*(_0x4deb5e/0x8),_0x46152f=new ArrayBuffer(0x2c+_0x269c9b),_0x2df274=new DataView(_0x46152f);writeString(_0x2df274,0x0,'RIFF'),_0x2df274[_0xbde887(0x200)](0x4,0x24+_0x269c9b,!![]),writeString(_0x2df274,0x8,_0xbde887(0x236)),writeString(_0x2df274,0xc,_0xbde887(0x241)),_0x2df274[_0xbde887(0x200)](0x10,0x10,!![]),_0x2df274[_0xbde887(0x1fe)](0x14,0x1,!![]),_0x2df274[_0xbde887(0x1fe)](0x16,_0x354368,!![]),_0x2df274[_0xbde887(0x200)](0x18,_0x8a6ea9,!![]),_0x2df274[_0xbde887(0x200)](0x1c,_0x1fd1cc,!![]),_0x2df274['setUint16'](0x20,_0x13ef55,!![]),_0x2df274[_0xbde887(0x1fe)](0x22,_0x4deb5e,!![]),writeString(_0x2df274,0x24,'data'),_0x2df274['setUint32'](0x28,_0x269c9b,!![]);let _0x24eee6=0x2c;for(let _0x7a5b25=0x0;_0x7a5b25<_0xb9c407[_0xbde887(0x242)];_0x7a5b25++,_0x24eee6+=0x2){_0x2df274[_0xbde887(0x222)](_0x24eee6,_0xb9c407[_0x7a5b25],!![]);}return new Blob([_0x2df274],{'type':_0xbde887(0x239)});}function writeString(_0x5a5fa5,_0x18b792,_0x464955){const _0x17cc6f=_0x212034;for(let _0xd801c1=0x0;_0xd801c1<_0x464955[_0x17cc6f(0x242)];_0xd801c1++){_0x5a5fa5[_0x17cc6f(0x25b)](_0x18b792+_0xd801c1,_0x464955[_0x17cc6f(0x252)](_0xd801c1));}}async function getAIResponse(_0x5e7ef6,_0x49599f){const _0x1ac644=_0x212034,_0x347afe=apiKeyInput[_0x1ac644(0x1f1)];if(!_0x347afe)return console['error'](_0x1ac644(0x1f8)),updateStatus(_0x1ac644(0x1db),_0x1ac644(0x271),!![]),null;const _0x34cb6c=voiceSelect[_0x1ac644(0x1f1)]===_0x1ac644(0x20e)?_0x1ac644(0x22a):_0x1ac644(0x1f0),_0xdf8fa2='คุณคือ\x20\x27'+_0x34cb6c+_0x1ac644(0x276),_0x2a9582=_0x49599f[_0x1ac644(0x255)](_0x4dd9a3=>({'role':_0x4dd9a3[_0x1ac644(0x254)]==='AI'?_0x1ac644(0x1cb):_0x1ac644(0x23c),'parts':[{'text':_0x4dd9a3[_0x1ac644(0x21a)]}]})),_0xaeb699={'contents':[..._0x2a9582,{'role':_0x1ac644(0x23c),'parts':[{'text':_0x1ac644(0x1cc)+_0x5e7ef6+'\x22)'}]}],'tools':[{'google_search':{}}],'systemInstruction':{'parts':[{'text':_0xdf8fa2}]}},_0x4d4ffe=_0x1ac644(0x23a)+_0x347afe;try{const _0x5a4a23=await fetch(_0x4d4ffe,{'method':_0x1ac644(0x245),'headers':{'Content-Type':_0x1ac644(0x25c)},'body':JSON['stringify'](_0xaeb699)});if(!_0x5a4a23['ok']){(_0x5a4a23[_0x1ac644(0x22c)]===0x190||_0x5a4a23['status']===0x193||_0x5a4a23[_0x1ac644(0x22c)]===0x191)&&(console[_0x1ac644(0x23e)](_0x1ac644(0x215)),updateStatus('ready',_0x1ac644(0x275),!![]));throw new Error('Chat\x20API\x20failed\x20with\x20status:\x20'+_0x5a4a23[_0x1ac644(0x22c)]);}const _0x4d8086=await _0x5a4a23[_0x1ac644(0x233)](),_0x35c568=_0x4d8086['candidates']?.[0x0]?.['content']?.['parts']?.[0x0]?.[_0x1ac644(0x21a)];if(!_0x35c568){console[_0x1ac644(0x23e)](_0x1ac644(0x266),_0x4d8086);throw new Error(_0x1ac644(0x244));}return _0x35c568;}catch(_0x32bacc){return console['error'](_0x1ac644(0x221),_0x32bacc),null;}}async function getEvaluation(_0xbdb2bb){const _0x409562=_0x212034,_0x83f4ff=apiKeyInput[_0x409562(0x1f1)];if(!_0x83f4ff)return console['error'](_0x409562(0x218)),null;const _0x4fccd0=_0xbdb2bb[_0x409562(0x255)](_0x2640bf=>_0x2640bf['sender']+':\x20'+_0x2640bf[_0x409562(0x21a)])['join']('\x0a'),_0x2e07ef=_0x409562(0x1e9)+_0x4fccd0+'\x0a',_0x46cdeb={'type':'OBJECT','properties':{'total_score':{'type':'NUMBER','description':'คะแนนรวม\x20(เต็ม\x20100)'},'scores':{'type':_0x409562(0x23b),'properties':{'product_knowledge':{'type':'NUMBER','description':_0x409562(0x1eb)},'accuracy':{'type':'NUMBER','description':_0x409562(0x1ca)},'communication':{'type':_0x409562(0x1f7),'description':_0x409562(0x264)},'problem_solving':{'type':_0x409562(0x1f7),'description':_0x409562(0x262)},'sales_skills':{'type':_0x409562(0x1f7),'description':_0x409562(0x225)},'service_attitude':{'type':_0x409562(0x1f7),'description':_0x409562(0x1e2)}}},'analysis':{'type':_0x409562(0x23b),'properties':{'strengths':{'type':_0x409562(0x26d),'items':{'type':'STRING'},'description':'จุดแข็งของพนักงาน\x20(อย่างน้อย\x202\x20ข้อ)'},'weaknesses':{'type':_0x409562(0x26d),'items':{'type':'STRING'},'description':_0x409562(0x1e8)},'key_moments_analysis':{'type':_0x409562(0x26d),'items':{'type':'STRING'},'description':_0x409562(0x216)}}}},'required':[_0x409562(0x26f),_0x409562(0x282),'analysis']},_0xd5f728={'contents':[{'parts':[{'text':_0x409562(0x263)}]}],'generationConfig':{'responseMimeType':_0x409562(0x25c),'responseSchema':_0x46cdeb},'systemInstruction':{'parts':[{'text':_0x2e07ef}]}},_0x1fc198='https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key='+_0x83f4ff;try{const _0x27ac19=await fetch(_0x1fc198,{'method':_0x409562(0x245),'headers':{'Content-Type':_0x409562(0x25c)},'body':JSON[_0x409562(0x1f9)](_0xd5f728)});if(!_0x27ac19['ok'])throw new Error(_0x409562(0x24f)+_0x27ac19[_0x409562(0x22c)]);const _0x590c98=await _0x27ac19['json'](),_0x4d8bf5=_0x590c98[_0x409562(0x232)]?.[0x0]?.[_0x409562(0x1dc)]?.['parts']?.[0x0]?.['text'];if(!_0x4d8bf5){console['error'](_0x409562(0x21c),_0x590c98);throw new Error(_0x409562(0x223));}return JSON[_0x409562(0x201)](_0x4d8bf5);}catch(_0x30da3d){return console[_0x409562(0x23e)](_0x409562(0x1f4),_0x30da3d),null;}}async function speak(_0xbeb7ec,_0x1936df){const _0x1118ca=_0x212034;currentAudio&&(currentAudio[_0x1118ca(0x1f2)](),currentAudio=null);const _0x1dafd3=apiKeyInput[_0x1118ca(0x1f1)];if(!_0x1dafd3)return console[_0x1118ca(0x23e)](_0x1118ca(0x1df)),updateStatus(_0x1118ca(0x1db),_0x1118ca(0x21f),!![]),Promise[_0x1118ca(0x1d0)](_0x1118ca(0x27e));const _0x4ad4d0=_0x1118ca(0x1de),_0x4da20d=_0x1118ca(0x228),_0x2e248b=_0x1936df===_0x1118ca(0x20e)?_0x4ad4d0:_0x4da20d,_0xa2bd29={'contents':[{'parts':[{'text':'พูดด้วยน้ำเสียงสนทนาที่เป็นธรรมชาติ:\x20'+_0xbeb7ec}]}],'generationConfig':{'responseModalities':[_0x1118ca(0x1e5)],'speechConfig':{'voiceConfig':{'prebuiltVoiceConfig':{'voiceName':_0x2e248b}}}},'model':_0x1118ca(0x269)},_0x4dfda5=_0x1118ca(0x1cd)+_0x1dafd3;try{const _0x9e32f7=await fetch(_0x4dfda5,{'method':_0x1118ca(0x245),'headers':{'Content-Type':_0x1118ca(0x25c)},'body':JSON[_0x1118ca(0x1f9)](_0xa2bd29)});if(!_0x9e32f7['ok']){(_0x9e32f7[_0x1118ca(0x22c)]===0x190||_0x9e32f7[_0x1118ca(0x22c)]===0x193||_0x9e32f7['status']===0x191)&&(console[_0x1118ca(0x23e)]('Invalid\x20API\x20Key\x20for\x20TTS'),updateStatus(_0x1118ca(0x1db),_0x1118ca(0x1e7),!![]));throw new Error(_0x1118ca(0x26e)+_0x9e32f7[_0x1118ca(0x22c)]);}const _0x44a21e=await _0x9e32f7['json'](),_0x7e19fa=_0x44a21e?.[_0x1118ca(0x232)]?.[0x0]?.[_0x1118ca(0x1dc)]?.['parts']?.[0x0],_0x12d74c=_0x7e19fa?.[_0x1118ca(0x249)]?.['data'],_0x49d9e1=_0x7e19fa?.[_0x1118ca(0x249)]?.[_0x1118ca(0x253)];if(_0x12d74c&&_0x49d9e1&&_0x49d9e1[_0x1118ca(0x1e6)]('audio/L16')){const _0x4f7a04=parseInt(_0x49d9e1[_0x1118ca(0x1e1)](/rate=(\d+)/)[0x1],0xa),_0x348bba=base64ToArrayBuffer(_0x12d74c),_0x24d9d9=pcmToWav(_0x348bba,_0x4f7a04),_0x3bb3ff=URL[_0x1118ca(0x1bc)](_0x24d9d9);return new Promise((_0x194427,_0x3de63d)=>{const _0x3419ab=_0x1118ca;currentAudio=new Audio(_0x3bb3ff),currentAudio[_0x3419ab(0x20f)]=()=>{currentAudio=null,_0x194427();},currentAudio[_0x3419ab(0x1ff)]=_0x639c30=>{const _0x57f271=_0x3419ab;currentAudio=null,console[_0x57f271(0x23e)](_0x57f271(0x246),_0x639c30),_0x3de63d(_0x639c30);},currentAudio['play']();});}else{console[_0x1118ca(0x23e)](_0x1118ca(0x1fa),_0x44a21e);throw new Error('Invalid\x20TTS\x20response\x20format');}}catch(_0x2e3870){return console[_0x1118ca(0x23e)](_0x1118ca(0x202),_0x2e3870),Promise[_0x1118ca(0x1d0)](_0x2e3870);}}window[_0x212034(0x22f)](_0x212034(0x22d),()=>{const _0x43c0f3=_0x212034,_0x12583d=localStorage[_0x43c0f3(0x27c)](_0x43c0f3(0x267));_0x12583d&&(apiKeyInput['value']=_0x12583d);}),saveKeyBtn[_0x212034(0x22f)](_0x212034(0x24e),()=>{const _0x4324ab=_0x212034,_0x109d57=apiKeyInput[_0x4324ab(0x1f1)];localStorage[_0x4324ab(0x20c)](_0x4324ab(0x267),_0x109d57);const _0x4949f3=statusText[_0x4324ab(0x273)];updateStatus('ready',_0x4324ab(0x1c2)),setTimeout(()=>{const _0xe798ec=_0x4324ab;!conversationFlag?updateStatus(_0xe798ec(0x1db),'พร้อมเริ่มการสนทนา'):updateStatus(_0xe798ec(0x1db),_0x4949f3);},0x7d0);}),startBtn[_0x212034(0x22f)](_0x212034(0x24e),startConversation),stopBtn[_0x212034(0x22f)](_0x212034(0x24e),stopConversation),sendBtn['addEventListener']('click',handleUserMessage),userInput[_0x212034(0x22f)]('keypress',_0x575d49=>{const _0xdc5edd=_0x212034;_0x575d49['key']===_0xdc5edd(0x21e)&&handleUserMessage();}),recordBtn[_0x212034(0x22f)]('click',()=>{const _0x133b86=_0x212034;recognition&&recognition[_0x133b86(0x25d)]();});function startConversation(){const _0x2aacb0=_0x212034;currentAudio&&(currentAudio[_0x2aacb0(0x1f2)](),currentAudio=null);if(!apiKeyInput['value']){updateStatus(_0x2aacb0(0x1db),_0x2aacb0(0x1d4),!![]);return;}startBtn[_0x2aacb0(0x26b)]=!![],stopBtn[_0x2aacb0(0x26b)]=![],transcriptBox['innerHTML']='',evaluationBox['innerHTML']=_0x2aacb0(0x205),evaluationBox[_0x2aacb0(0x1d7)][_0x2aacb0(0x25a)](_0x2aacb0(0x260)),loadingSpinner[_0x2aacb0(0x1d7)]['add'](_0x2aacb0(0x260)),updateStatus(_0x2aacb0(0x1db),_0x2aacb0(0x22e)),conversationFlag=!![],conversationHistory=[],userInput['disabled']=![],sendBtn['disabled']=![];if(recognition)recordBtn[_0x2aacb0(0x26b)]=![];userInput[_0x2aacb0(0x243)]();}function _0xd2c3(){const _0x4c5b2e=['Missing\x20API\x20Key','1.\x20ความรู้ผลิตภัณฑ์/บริการ','stop','save-key-btn','scores','recording-btn','loading-spinner','createObjectURL','sales_skills','listening','รอ\x20AI\x20ตอบกลับ...','2.\x20ความถูกต้องของคำตอบ','stop-btn','API\x20Key\x20ถูกบันทึกแล้ว!','push','2270AWLwMn','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22bg-orange-100\x20text-gray-800\x20p-3\x20rounded-lg\x20rounded-br-none\x20max-w-xs\x20md:max-w-md\x20shadow-sm\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','465gTITsb','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','weaknesses','เบราว์เซอร์นี้ไม่รองรับการพูด','2.\x20ความถูกต้องในการตอบปัญหาผลิตภัณฑ์\x20(เต็ม\x2020)','model','(ค้นหาข้อมูล\x20TTBANK\x20ที่ถูกต้องเกี่ยวกับ:\x20\x22','https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=','</li>','\x20/\x20','reject','3.\x20ทักษะการสื่อสาร','5.\x20ทักษะการขาย/โน้มน้าว','พร้อมเริ่มการสนทนา','กรุณาใส่\x20API\x20Key\x20ในช่องตั้งค่าก่อนครับ','5370582MInlIn','<div\x20class=\x22text-center\x20text-red-500\x20py-10\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22font-medium\x22>การประเมินผลล้มเหลว</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-sm\x22>กรุณาตรวจสอบ\x20API\x20Key\x20หรือลองอีกครั้ง</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','classList','5OgDDNW','add','คุณ\x20(พนักงาน)','ready','content','คุณที\x20(AI)','Callirrhoe','Missing\x20API\x20Key.\x20Cannot\x20call\x20TTS\x20API.','status-icon-ready','match','6.\x20ทัศนคติในการให้บริการ\x20อารมณ์\x20และการสร้างความประทับใจ\x20(เต็ม\x2015)','buffer','warn','AUDIO','startsWith','ข้อผิดพลาด:\x20API\x20Key\x20ไม่ถูกต้อง\x20(TTS)','จุดที่พนักงานควรพัฒนา\x20(อย่างน้อย\x202\x20ข้อ)','คุณคือผู้ประเมินผลการฝึกอบรมพนักงาน\x20TTB\x20ที่เชี่ยวชาญและยุติธรรม\x0aจงวิเคราะห์บทสนทนาต่อไปนี้ระหว่าง\x20\x22คุณ\x20(พนักงาน)\x22\x20และ\x20\x22AI\x20(ลูกค้า)\x22\x0aหน้าที่ของคุณคือประเมิน\x20\x22พนักงาน\x22\x20เท่านั้น\x20โดยโฟกัสที่คำถามและคำตอบของพนักงาน\x0a\x0a**จงประเมินและให้คะแนนตามเกณฑ์\x206\x20ข้อต่อไปนี้\x20(รวม\x20100\x20คะแนน):**\x0a1.\x20\x20**ความรู้ด้านผลิตภัณฑ์และบริการ\x20(20\x20คะแนน):**\x20พนักงานมีความเข้าใจในผลิตภัณฑ์\x20บริการ\x20และโปรโมชั่นของ\x20TTB\x20ลึกซึ้งเพียงใด\x0a2.\x20\x20**ความถูกต้องในการตอบปัญหาผลิตภัณฑ์\x20(20\x20คะแนน):**\x20พนักงานให้ข้อมูล\x20(ดอกเบี้ย,\x20ค่าธรรมเนียม,\x20เงื่อนไข)\x20ถูกต้องแม่นยำหรือไม่\x0a3.\x20\x20**ทักษะด้านการสื่อสาร\x20การฟัง\x20การตอบสนอง\x20(15\x20คะแนน):**\x20ใช้ภาษาชัดเจน\x20สุภาพ\x20มีการฟังจับใจความ\x20และตอบสนองได้ตรงประเด็นหรือไม่\x0a4.\x20\x20**ไหวพริบและการแก้ไขปัญหา\x20การตอบข้อโต้แย้ง\x20(15\x20คะแนน):**\x20เมื่อ\x20AI\x20(ลูกค้า)\x20\x27ท้วงติง\x27\x20หรือ\x20\x27มีข้อโต้แย้ง\x27\x20พนักงานรับมืออย่างไร\x20แก้ปัญหาเฉพาะหน้าได้ดีหรือไม่\x0a5.\x20\x20**ด้านการขาย\x20การโน้มน้าว\x20และการปิดการขาย\x20(15\x20คะแนน):**\x20พนักงานมีความพยายามในการนำเสนอขาย\x20(Cross-sell,\x20Up-sell),\x20โน้มน้าวใจ,\x20และพยายามปิดการขายหรือไม่\x0a6.\x20\x20**ทัศนคติในการให้บริการ\x20อารมณ์\x20และการสร้างความประทับใจ\x20(15\x20คะแนน):**\x20พนักงานมีความกระตือรือร้น,\x20คุมอารมณ์,\x20และสร้างประสบการณ์ที่ดีให้ลูกค้าหรือไม่\x0a\x0aจงให้คะแนนตามเกณฑ์ที่กำหนดอย่างเข้มงวด\x20และให้คำวิจารณ์\x20(จุดแข็ง/จุดอ่อน)\x20ที่ชัดเจนและนำไปปฏิบัติได้จริง\x0a\x0aบทสนทนา:\x0a','evaluation-box','1.\x20ความรู้ด้านผลิตภัณฑ์และบริการ\x20(เต็ม\x2020)','Speech\x20recognition\x20error:','user-input','appendChild','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</ul>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20[REVISED]\x20แสดงผลการวิเคราะห์เหตุการณ์สำคัญ\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22text-lg\x20font-semibold\x20text-blue-600\x20mb-2\x20mt-4\x22>วิเคราะห์เหตุการณ์สำคัญ</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20class=\x22list-disc\x20list-inside\x20text-gray-700\x20space-y-1\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','คุณที','value','pause','flex-col','Error\x20calling\x20Gemini\x20Evaluation:','\x20-\x20','%\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','NUMBER','Missing\x20API\x20Key\x20for\x20Chat','stringify','Invalid\x20TTS\x20response\x20format:','status-error','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-2xl\x20font-medium\x20text-gray-600\x22>/100</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22space-y-3\x20mb-5\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','APIเสียงล้มเหลว.\x20โปรดตรวจสอบKey/ลองใหม่','setUint16','onerror','setUint32','parse','Error\x20calling\x20Gemini\x20TTS:','17884ToXVna','th-TH','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22text-center\x20text-gray-500\x20py-10\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20class=\x22mx-auto\x20h-12\x20w-12\x20text-gray-400\x22\x20fill=\x22none\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20stroke=\x22currentColor\x22><path\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22\x20stroke-width=\x222\x22\x20d=\x22M9\x2017v-2m3\x202v-4m3\x204v-6m2\x2010H7a2\x202\x200\x2001-2-2V7c0-1.1.9-2\x202-2h11l4\x204v11c0\x201.1-.9\x202-2\x202z\x22\x20/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22mt-2\x20text-sm\x20font-medium\x22>ผลการประเมินจะแสดงที่นี่<br>หลังจากสิ้นสุดการสนทนา</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','communication','results','problem_solving','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22font-bold\x20text-sm\x20text-right\x20ttb-orange-text\x20mb-1\x22>','input-area','className','setItem','Speech\x20playback\x20failed:','female','onended','scrollHeight','1023222QXLuUS','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22ttb-blue-text\x22>','webkitSpeechRecognition','flex\x20items-center\x20justify-between\x20p-3\x20bg-gray-50\x20rounded-lg\x20border\x20border-gray-200\x20hover:bg-gray-100\x20transition','Invalid\x20API\x20Key\x20for\x20Chat','วิเคราะห์เหตุการณ์สำคัญ:\x20ระบุจุดที่พนักงานตอบถูก/ผิด,\x20การรับมือข้อโต้แย้ง,\x20หรือการพยายามปิดการขาย','numeric','Missing\x20API\x20Key\x20for\x20Evaluation','record-btn','text','flex','Invalid\x20Evaluation\x20response:','createElement','Enter','ข้อผิดพลาด:\x20กรุณาใส่\x20API\x20Key\x20(TTS)','service_attitude','Error\x20calling\x20Gemini\x20Chat:','setInt16','Evaluation\x20response\x20is\x20empty','send-btn','5.\x20ด้านการขาย\x20การโน้มน้าว\x20และการปิดการขาย\x20(เต็ม\x2015)','innerHTML','981232gvPstv','Zubenelgenubi','transcript-box','คุณฟ้า','pulse-dot','status','load','ตาคุณพูด:\x20กรุณาพิมพ์\x20หรือ\x20กดไมค์','addEventListener','onend','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22text-right\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22text-lg\x20font-bold\x20ttb-blue-text\x22>','candidates','json','Chat\x20APIล้มเหลว.\x20โปรดตรวจสอบKey/ลองใหม่','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20justify-between\x20text-sm\x20font-medium\x20mb-1\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-gray-700\x22>','WAVE','accuracy','getElementById','audio/wav','https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=','OBJECT','user','start-btn','error','items-start','1841370ESaBeN','fmt\x20','length','focus','Invalid\x20Chat\x20response\x20format','POST','Audio\x20playback\x20error','Speech\x20Recognition\x20API\x20is\x20not\x20supported\x20in\x20this\x20browser.','voice-select','inlineData','product_knowledge','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22text-center\x20mb-4\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-6xl\x20font-bold\x20ttb-blue-text\x22>','1141596bwRuoF','<li>-</li>','click','Evaluation\x20API\x20failed\x20with\x20status:\x20','<li>ไม่มีข้อสังเกตพิเศษ</li>','onresult','charCodeAt','mimeType','sender','map','\x20คะแนน</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22#\x22\x20class=\x22text-sm\x20text-orange-600\x20hover:underline\x22\x20onclick=\x22event.preventDefault();\x20console.log(\x27View\x20transcript\x20clicked\x27);\x22>ดูบทสนทนา</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','join','lang','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','remove','setUint8','application/json','start','toLocaleDateString','<li>','hidden','interimResults','4.\x20ไหวพริบและการแก้ไขปัญหา\x20การตอบข้อโต้แย้ง\x20(เต็ม\x2015)','โปรดประเมินบทสนทนานี้ตาม\x20Schema\x20ที่กำหนด','3.\x20ทักษะด้านการสื่อสาร\x20การฟัง\x20การตอบสนอง\x20(เต็ม\x2015)','strengths','Invalid\x20Chat\x20response\x20format:','geminiApiKey','key_moments_analysis','gemini-2.5-flash-preview-tts','onspeechend','disabled','toFixed','ARRAY','TTS\x20API\x20failed\x20with\x20status:\x20','total_score','api-key-input','ข้อผิดพลาด:\x20กรุณาใส่\x20API\x20Key','50523IXbcQI','textContent','SpeechRecognition','ข้อผิดพลาด:\x20API\x20Key\x20ไม่ถูกต้อง\x20(Chat)','\x27\x20AI\x20อัจฉริยะของ\x20TTB\x20\x0aคุณกำลังสวมบทบาทเป็น\x20\x27ลูกค้าช่างสังเกต\x27\x20เพื่อซ้อมบทสนทนากับพนักงาน\x0a**ภารกิจสำคัญของคุณคือการตรวจสอบความถูกต้องของข้อมูลที่พนักงานพูด\x20และทดสอบทักษะการรับมือของพนักงาน**\x0a\x0a1.\x20\x20เมื่อพนักงาน\x20(user)\x20ให้ข้อมูลผลิตภัณฑ์\x20(เช่น\x20อัตราดอกเบี้ย,\x20ค่าธรรมเนียม)\x0a2.\x20\x20จงเปรียบเทียบข้อมูลนั้นกับ\x20\x27ผลการค้นหา\x20(search\x20results)\x27\x20ที่ระบบส่งมาให้\x20(ซึ่งมาจากเว็บ\x20TTB)\x0a3.\x20\x20**[กรณีพนักงานตอบผิด]**:\x20หากข้อมูลที่พนักงานพูด\x20\x27ขัดแย้ง\x27\x20กับผลการค้นหา\x20คุณต้อง\x20\x27ย้อนถาม\x27\x20ทันที\x0a\x20\x20\x20\x20*\x20ตัวอย่าง:\x20\x22เอ...\x20คุณแน่ใจเหรอคะ?\x20พอดีฉันเพิ่งอ่านเจอในเว็บ\x20TTB\x20ว่า...\x22\x20(อ้างอิงข้อมูลที่ถูกต้องจากผลการค้นหา)\x0a4.\x20\x20**[การถามซ้ำ]**:\x20หากพนักงานยังคงตอบผิดหรือเลี่ยงคำตอบ\x20จง\x20\x27ถามซ้ำ\x27\x20อย่างสุภาพแต่ชัดเจน\x20หรือ\x20\x27เสนอข้อมูลที่ถูกต้อง\x27\x20ที่คุณพบจากผลการค้นหา\x20แล้วถามพนักงานว่า\x20\x22ข้อมูลนี้ถูกต้องใช่ไหมคะ?\x22\x20เพื่อบังคับให้พนักงานยอมรับหรือแก้ไขข้อมูล\x0a5.\x20\x20**[ทดสอบการขาย/แก้ปัญหา]**:\x20ในระหว่างสนทนา\x20ให้คุณสวมบทบาทเป็นลูกค้าที่อาจมี\x20\x27ข้อโต้แย้ง\x27\x20(เช่น\x20\x22ทำไมดอกเบี้ยแพงจัง\x22,\x20\x22แอปอื่นดีกว่า\x22)\x20หรือ\x20\x27ลังเล\x27\x20(เช่น\x20\x22ขอคิดดูก่อน\x22)\x20เพื่อทดสอบไหวพริบและทักษะการโน้มน้าวของพนักงาน\x0a6.\x20\x20**[กรณีพนักงานตอบถูก]**:\x20หากข้อมูลถูกต้อง\x20ให้สนทนาต่อไปตามปกติในฐานะลูกค้า\x0a7.\x20\x20จงโฟกัสที่ผลิตภัณฑ์\x20TTB\x20และถามคำถามที่เกี่ยวข้องต่อไป\x0a8.\x20\x20ให้ตอบกลับเป็นภาษาไทยที่กระชับและเป็นธรรมชาติ','49BSbfjF','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20items-center\x20space-x-3\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20class=\x22h-6\x20w-6\x20text-blue-500\x22\x20fill=\x22none\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20stroke=\x22currentColor\x22><path\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22\x20stroke-width=\x222\x22\x20d=\x22M8\x2012h.01M12\x2012h.01M16\x2012h.01M21\x2012c0\x204.418-4.03\x208-9\x208a9.863\x209.863\x200\x2001-4.255-.949L3\x2020l1.395-3.72C3.512\x2015.042\x203\x2013.574\x203\x2012c0-4.418\x204.03-8\x209-8s9\x203.582\x209\x208z\x22\x20/></svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22font-semibold\x20ttb-blue-text\x22>การสนทนาครั้งที่\x20','2-digit','AI\x20กำลังพูด...','6.\x20ทัศนคติ/การบริการ','getItem','กำลังฟังเสียงคุณ...'];_0xd2c3=function(){return _0x4c5b2e;};return _0xd2c3();}function stopConversation(){const _0x285d7f=_0x212034;conversationFlag=![],currentAudio&&(currentAudio['pause'](),currentAudio=null),recognition&&recognition[_0x285d7f(0x280)](),startBtn[_0x285d7f(0x26b)]=![],stopBtn['disabled']=!![],userInput[_0x285d7f(0x26b)]=!![],sendBtn[_0x285d7f(0x26b)]=!![],recordBtn['disabled']=!![],updateStatus(_0x285d7f(0x1db),'สิ้นสุดการสนทนา'),showRealEvaluation();}async function handleUserMessage(){const _0x12b987=_0x212034,_0xcfbf10=userInput[_0x12b987(0x1f1)];if(!_0xcfbf10||!conversationFlag)return;addMessageToTranscript(_0x12b987(0x1da),_0xcfbf10,_0x12b987(0x23c)),conversationHistory[_0x12b987(0x1c3)]({'sender':_0x12b987(0x1da),'text':_0xcfbf10}),userInput[_0x12b987(0x1f1)]='',setInputsDisabled(!![]),updateStatus('listening','AI\x20กำลังคิด...');const _0x5a6302=await getAIResponse(_0xcfbf10,conversationHistory);if(_0x5a6302===null){updateStatus(_0x12b987(0x1db),_0x12b987(0x234),!![]),setInputsDisabled(![]);return;}conversationHistory[_0x12b987(0x1c3)]({'sender':'AI','text':_0x5a6302});try{const _0x41eb2b=voiceSelect['value']===_0x12b987(0x20e)?'คุณฟ้า\x20(AI)':_0x12b987(0x1dd);await addMessageToTranscript(_0x41eb2b,_0x5a6302,'ai');}catch(_0x40f9e0){console[_0x12b987(0x23e)]('Failed\x20to\x20speak:',_0x40f9e0),updateStatus(_0x12b987(0x1db),_0x12b987(0x1fd),!![]),setInputsDisabled(![]);return;}conversationFlag&&(setInputsDisabled(![]),updateStatus(_0x12b987(0x1db),'ตาคุณพูด:\x20กรุณาพิมพ์\x20หรือ\x20กดไมค์'),userInput[_0x12b987(0x243)]());}function setInputsDisabled(_0x37b39e){const _0x33faca=_0x212034;userInput[_0x33faca(0x26b)]=_0x37b39e,sendBtn[_0x33faca(0x26b)]=_0x37b39e;if(recognition)recordBtn[_0x33faca(0x26b)]=_0x37b39e;}function updateStatus(_0x5ea9af,_0x27b69e,_0x3e029a=![]){const _0x53bbcf=_0x212034;statusText['textContent']=_0x27b69e;_0x3e029a?statusText[_0x53bbcf(0x1d7)][_0x53bbcf(0x1d9)](_0x53bbcf(0x1fb)):statusText[_0x53bbcf(0x1d7)][_0x53bbcf(0x25a)]('status-error');if(_0x5ea9af===_0x53bbcf(0x1db))statusIconReady['classList'][_0x53bbcf(0x25a)](_0x53bbcf(0x260)),statusIconListening['classList'][_0x53bbcf(0x1d9)](_0x53bbcf(0x260)),statusIconListening[_0x53bbcf(0x1d7)][_0x53bbcf(0x25a)](_0x53bbcf(0x22b));else _0x5ea9af==='listening'&&(statusIconReady['classList']['add'](_0x53bbcf(0x260)),statusIconListening['classList'][_0x53bbcf(0x25a)](_0x53bbcf(0x260)),statusIconListening[_0x53bbcf(0x1d7)][_0x53bbcf(0x1d9)](_0x53bbcf(0x22b)));}async function addMessageToTranscript(_0x2b0004,_0x21ff44,_0x169401){const _0x1cefcc=_0x212034,_0x4eb941=document[_0x1cefcc(0x21d)]('div');_0x4eb941[_0x1cefcc(0x1d7)][_0x1cefcc(0x1d9)](_0x1cefcc(0x21b),_0x1cefcc(0x1f3));if(_0x169401===_0x1cefcc(0x23c))return _0x4eb941[_0x1cefcc(0x1d7)][_0x1cefcc(0x1d9)]('items-end'),_0x4eb941[_0x1cefcc(0x226)]=_0x1cefcc(0x209)+_0x2b0004+_0x1cefcc(0x1c5)+_0x21ff44+_0x1cefcc(0x1c7),transcriptBox[_0x1cefcc(0x1ee)](_0x4eb941),transcriptBox['scrollTop']=transcriptBox[_0x1cefcc(0x210)],Promise['resolve']();else{_0x4eb941[_0x1cefcc(0x1d7)][_0x1cefcc(0x1d9)](_0x1cefcc(0x23f)),_0x4eb941[_0x1cefcc(0x226)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22font-bold\x20text-sm\x20text-left\x20ttb-blue-text\x20mb-1\x22>'+_0x2b0004+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22bg-blue-100\x20text-gray-800\x20p-3\x20rounded-lg\x20rounded-bl-none\x20max-w-xs\x20md:max-w-md\x20shadow-sm\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x21ff44+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',transcriptBox['appendChild'](_0x4eb941),transcriptBox['scrollTop']=transcriptBox[_0x1cefcc(0x210)],updateStatus(_0x1cefcc(0x1be),_0x1cefcc(0x27a));const _0x4cd6ce=voiceSelect[_0x1cefcc(0x1f1)];try{await speak(_0x21ff44,_0x4cd6ce);}catch(_0x2171f7){console['error'](_0x1cefcc(0x20d),_0x2171f7);throw _0x2171f7;}}}async function showRealEvaluation(){const _0x336087=_0x212034;if(conversationHistory['length']===0x0){updateStatus(_0x336087(0x1db),_0x336087(0x1d3));return;}evaluationBox[_0x336087(0x1d7)]['add'](_0x336087(0x260)),loadingSpinner['classList'][_0x336087(0x25a)]('hidden');const _0x5a2c6e=await getEvaluation(conversationHistory);if(_0x5a2c6e===null){evaluationBox['classList']['remove'](_0x336087(0x260)),loadingSpinner['classList'][_0x336087(0x1d9)](_0x336087(0x260)),evaluationBox[_0x336087(0x226)]=_0x336087(0x1d6);return;}evaluationBox['classList']['remove']('hidden'),loadingSpinner['classList'][_0x336087(0x1d9)](_0x336087(0x260));const _0x183e1d=_0x5a2c6e[_0x336087(0x282)],_0x341d0a=_0x5a2c6e[_0x336087(0x26f)],_0x4ec7b2=_0x5a2c6e['analysis'];evaluationBox[_0x336087(0x226)]=_0x336087(0x24b)+_0x341d0a['toFixed'](0x0)+_0x336087(0x1fc)+createScoreBar(_0x336087(0x27f),_0x183e1d[_0x336087(0x24a)],0x14)+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+createScoreBar(_0x336087(0x1c0),_0x183e1d[_0x336087(0x237)],0x14)+_0x336087(0x259)+createScoreBar(_0x336087(0x1d1),_0x183e1d[_0x336087(0x206)],0xf)+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+createScoreBar('4.\x20ไหวพริบ/แก้ปัญหา',_0x183e1d[_0x336087(0x208)],0xf)+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+createScoreBar(_0x336087(0x1d2),_0x183e1d[_0x336087(0x1bd)],0xf)+_0x336087(0x259)+createScoreBar(_0x336087(0x27b),_0x183e1d[_0x336087(0x220)],0xf)+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22text-lg\x20font-semibold\x20text-green-600\x20mb-2\x22>จุดแข็ง\x20(Strengths)</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20class=\x22list-disc\x20list-inside\x20text-gray-700\x20space-y-1\x20mb-4\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x4ec7b2[_0x336087(0x265)][_0x336087(0x242)]>0x0?_0x4ec7b2[_0x336087(0x265)][_0x336087(0x255)](_0x9dfeb8=>_0x336087(0x25f)+_0x9dfeb8+'</li>')[_0x336087(0x257)](''):_0x336087(0x24d))+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</ul>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22text-lg\x20font-semibold\x20text-red-600\x20mb-2\x22>จุดที่ควรพัฒนา\x20(Weaknesses)</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20class=\x22list-disc\x20list-inside\x20text-gray-700\x20space-y-1\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x4ec7b2[_0x336087(0x1c8)]['length']>0x0?_0x4ec7b2['weaknesses'][_0x336087(0x255)](_0x4a862d=>_0x336087(0x25f)+_0x4a862d+_0x336087(0x1ce))[_0x336087(0x257)](''):_0x336087(0x24d))+_0x336087(0x1ef)+(_0x4ec7b2[_0x336087(0x268)][_0x336087(0x242)]>0x0?_0x4ec7b2['key_moments_analysis'][_0x336087(0x255)](_0x1eb0d6=>_0x336087(0x25f)+_0x1eb0d6+_0x336087(0x1ce))[_0x336087(0x257)](''):_0x336087(0x250))+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</ul>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',logSession(_0x341d0a);}function createScoreBar(_0xf3ec44,_0x4cfd88,_0x527b33){const _0x445f02=_0x212034,_0x5b96d4=_0x4cfd88||0x0,_0x1d8d1b=_0x5b96d4/_0x527b33*0x64;return _0x445f02(0x235)+_0xf3ec44+_0x445f02(0x212)+_0x5b96d4[_0x445f02(0x26c)](0x0)+_0x445f02(0x1cf)+_0x527b33+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22w-full\x20bg-gray-200\x20rounded-full\x20h-2.5\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ttb-blue\x20h-2.5\x20rounded-full\x22\x20style=\x22width:\x20'+_0x1d8d1b+_0x445f02(0x1f6);}function logSession(_0x48f645){const _0x24a069=_0x212034;historyCount++;historyCount===0x1&&(historyBox['innerHTML']='');const _0x29c83e=document[_0x24a069(0x21d)]('div');_0x29c83e[_0x24a069(0x20b)]=_0x24a069(0x214);const _0x2b4a40=new Date(),_0x1a6760=_0x2b4a40['toLocaleTimeString'](_0x24a069(0x204),{'hour':_0x24a069(0x279),'minute':_0x24a069(0x279)}),_0x35fd41=_0x2b4a40[_0x24a069(0x25e)](_0x24a069(0x204),{'day':_0x24a069(0x279),'month':'short','year':_0x24a069(0x217)}),_0x159195=_0x48f645||0x0;_0x29c83e[_0x24a069(0x226)]=_0x24a069(0x278)+historyCount+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22text-sm\x20text-gray-500\x22>'+_0x35fd41+_0x24a069(0x1f5)+_0x1a6760+_0x24a069(0x231)+_0x159195[_0x24a069(0x26c)](0x0)+_0x24a069(0x256),historyBox['prepend'](_0x29c83e);}
    </script>

</body>
</html>


